<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Resume</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            padding: 20px;
            background-color: #2a418e;
            color: #fff;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: bold;
        }

        .header img {
            border-radius: 50%;
            border: 4px solid #fff;
            width: 120px;
            height: 120px;
            object-fit: cover;
            margin: 10px auto;
            display: block;
        }

        .content {
            padding: 20px;
        }

        .section {
            margin-bottom: 20px;
        }

        .section h2 {
            font-size: 1.8em;
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .section p {
            margin: 10px 0;
            line-height: 1.6;
            color: #666;
        }

        .section p strong {
            color: #2a418e;
            display: inline-block;
            width: 150px;
        }

        .footer {
            text-align: center;
            padding: 10px;
            background-color: #f4f4f9;
            border-top: 1px solid #ddd;
            color: #666;
        }

        .footer p {
            margin: 5px 0;
        }

        #button-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        #download-btn, #edit-btn {
            background-color: #2a418e;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
        }

        #download-btn:hover, #edit-btn:hover {
            background-color: #1d2e70;
        }

        .hide-on-pdf {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container" id="resume">
        <div class="header">
            <h1 id="full-name" contenteditable="true"></h1>
            <img id="profile-photo" src="#" alt="Profile Photo" contenteditable="true">
            <p>Email: <span id="email" contenteditable="true"></span></p>
            <p>Phone: <span id="phone" contenteditable="true"></span></p>
        </div>
        <div class="content">
            <div class="section" id="education-section">
                <h2>Education</h2>
                <div id="education-content"></div>
            </div>
            <div class="section" id="work-experience-section">
                <h2>Work Experience</h2>
                <div id="work-experience-content"></div>
            </div>
            <div class="section">
                <h2>Skills</h2>
                <p id="skills"></p>
            </div>
            <div class="section" id="achievements-section">
                <h2>Achievements</h2>
                <div id="achievements-content"></div>
            </div>
            <div class="section" id="references-section">
                <h2>References</h2>
                <div id="references-content"></div>
            </div>
        </div>
        <div id="button-container" class="footer">
            <button id="download-btn">Download Resume</button>
            <button id="edit-btn">Edit Resume</button>
            <button id="save-btn" style="display: none;">Save Changes</button>
        </div>        
        <div class="footer">
            <p>&copy; 2024 Your Name. All rights reserved.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function getQueryParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            const fullName = getQueryParam('fullName');
            const email = getQueryParam('email');
            const phone = getQueryParam('phone');
            const education = JSON.parse(getQueryParam('education'));
            const workExperience = JSON.parse(getQueryParam('workExperience'));
            const skills = getQueryParam('skills');
            const achievements = JSON.parse(getQueryParam('achievements'));
            const references = JSON.parse(getQueryParam('references'));

            document.getElementById('full-name').textContent = fullName;
            document.getElementById('email').textContent = email;
            document.getElementById('phone').textContent = phone;

            const profilePhoto = sessionStorage.getItem('profilePhoto');
            const profilePhotoElement = document.getElementById('profile-photo');
            if (profilePhoto) {
                profilePhotoElement.src = profilePhoto;
                profilePhotoElement.style.display = 'block';
            } else {
                profilePhotoElement.style.display = 'none';
            }

            const educationContent = document.getElementById('education-content');
            education.forEach(item => {
                const educationItem = document.createElement('div');
                educationItem.innerHTML = `
                    <p><strong>School/University:</strong> <span contenteditable="true">${item.school}</span></p>
                    <p><strong>Degree:</strong> <span contenteditable="true">${item.degree}</span></p>
                    <p><strong>Year:</strong> <span contenteditable="true">${item.year}</span></p>
                `;
                educationContent.appendChild(educationItem);
            });

            const workExperienceContent = document.getElementById('work-experience-content');
            workExperience.forEach(item => {
                const workExperienceItem = document.createElement('div');
                workExperienceItem.innerHTML = `
                    <p><strong>Position:</strong> <span contenteditable="true">${item.position}</span></p>
                    <p><strong>Company:</strong> <span contenteditable="true">${item.company}</span></p>
                    <p><strong>Year:</strong> <span contenteditable="true">${item.year}</span></p>
                `;
                workExperienceContent.appendChild(workExperienceItem);
            });

            document.getElementById('skills').textContent = skills;

            const achievementsContent = document.getElementById('achievements-content');
            achievements.forEach(item => {
                const achievementItem = document.createElement('div');
                achievementItem.innerHTML = `
                    <p><strong>Description:</strong> <span contenteditable="true">${item.description}</span></p>
                `;
                achievementsContent.appendChild(achievementItem);
            });

            const referencesContent = document.getElementById('references-content');
            references.forEach(item => {
                const referenceItem = document.createElement('div');                referenceItem.innerHTML = `
                    <p><strong>Name:</strong> <span contenteditable="true">${item.name}</span></p>
                    <p><strong>Contact:</strong> <span contenteditable="true">${item.contact}</span></p>
                `;
                referencesContent.appendChild(referenceItem);
            });
        });

        document.getElementById('download-btn').addEventListener('click', function () {
            const element = document.getElementById('resume');
            const buttons = document.querySelectorAll('#download-btn, #edit-btn, #save-btn');
            buttons.forEach(button => button.classList.add('hide-on-pdf'));

            html2pdf(element, {
                margin:       0,
                filename:     'resume.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            }).then(() => {
                buttons.forEach(button => button.classList.remove('hide-on-pdf'));
            });
        });

        document.getElementById('edit-btn').addEventListener('click', function () {
            const editableElements = document.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(element => {
                element.contentEditable = true;
            });
            document.getElementById('save-btn').style.display = 'inline-block';
            document.getElementById('edit-btn').style.display = 'none';
        });

        document.getElementById('save-btn').addEventListener('click', function () {
            const updatedDetails = {
                fullName: document.getElementById('full-name').textContent,
                email: document.getElementById('email').textContent,
                phone: document.getElementById('phone').textContent,
                education: Array.from(document.querySelectorAll('#education-content div')).map(item => ({
                    school: item.querySelector('span:nth-child(1)').textContent,
                    degree: item.querySelector('span:nth-child(2)').textContent,
                    year: item.querySelector('span:nth-child(3)').textContent
                })),
                workExperience: Array.from(document.querySelectorAll('#work-experience-content div')).map(item => ({
                    position: item.querySelector('span:nth-child(1)').textContent,
                    company: item.querySelector('span:nth-child(2)').textContent,
                    year: item.querySelector('span:nth-child(3)').textContent
                })),
                skills: document.getElementById('skills').textContent,
                achievements: Array.from(document.querySelectorAll('#achievements-content div')).map(item => ({
                    description: item.querySelector('span').textContent
                })),
                references: Array.from(document.querySelectorAll('#references-content div')).map(item => ({
                    name: item.querySelector('span:nth-child(1)').textContent,
                    contact: item.querySelector('span:nth-child(2)').textContent
                }))
            };

            localStorage.setItem('updatedDetails', JSON.stringify(updatedDetails));

            const editableElements = document.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(element => {
                element.contentEditable = false;
            });
            document.getElementById('save-btn').style.display = 'none';
            document.getElementById('edit-btn').style.display = 'inline-block';
            alert('Changes saved successfully!');
        });
    </script>
</body>
</html>
